// Test script to upload an image with FormData
const fs = require('fs');
const FormData = require('form-data');
const axios = require('axios');

// Create a simple test image (1x1 red pixel PNG)
const pngBuffer = Buffer.from([
    0x89, 0x50, 0x4E, 0x47, 0x0D, 0x0A, 0x1A, 0x0A, 0x00, 0x00, 0x00, 0x0D,
    0x49, 0x48, 0x44, 0x52, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x01,
    0x08, 0x02, 0x00, 0x00, 0x00, 0x90, 0x77, 0x53, 0xDE, 0x00, 0x00, 0x00,
    0x0C, 0x49, 0x44, 0x41, 0x54, 0x08, 0x99, 0x63, 0xF8, 0xCF, 0xC0, 0x00,
    0x00, 0x00, 0x03, 0x00, 0x01, 0x5B, 0x4F, 0x6E, 0xFB, 0x00, 0x00, 0x00,
    0x00, 0x49, 0x45, 0x4E, 0x44, 0xAE, 0x42, 0x60, 0x82
]);

const form = new FormData();
form.append('action', 'post_photo');
form.append('pageId', '17841401401016275'); // Test IG ID
form.append('fbPageId', '949128981620522'); // Test FB page
form.append('fbPageToken', process.env.FB_PAGE_TOKEN || 'test-token');
form.append('message', 'Test image upload');
form.append('photoData', pngBuffer, 'test.png');

axios.post('http://localhost:3000/api/facebook', form, {
    headers: {
        ...form.getHeaders(),
        'x-access-token': process.env.FB_ACCESS_TOKEN || 'test-token'
    }
})
.then(res => console.log('Success:', res.data))
.catch(err => console.error('Error:', err.response?.data || err.message));
